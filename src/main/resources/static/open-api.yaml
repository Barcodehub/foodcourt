openapi: 3.0.3
info:
  title: FoodCourt Management API
  description: API para gestión de restaurantes y platos - Plazoleta de comidas
  version: 1.0.0
  contact:
    name: Pragma PowerUp Team

servers:
  - url: http://localhost:8080
    description: Servidor local de desarrollo


paths:
  /restaurants:
    get:
      tags:
        - Restaurants
      summary: Listar restaurantes
      description: Lista todos los restaurantes disponibles ordenados alfabéticamente
      operationId: listRestaurants
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: Número de página (empezando en 0)
          required: false
          schema:
            type: integer
            default: 0
            minimum: 0
        - name: size
          in: query
          description: Cantidad de elementos por página
          required: false
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
      responses:
        '200':
          description: Lista de restaurantes obtenida exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestaurantListResponse'
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      tags:
        - Restaurants
      summary: Crear un nuevo restaurante
      description: Crea un nuevo restaurante en el sistema (solo usuarios con rol propietario)
      operationId: createRestaurant
      security:
        - bearerAuth: []
      requestBody:
        description: Datos del restaurante a crear
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RestaurantRequest'
      responses:
        '201':
          description: Restaurante creado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestaurantDataResponse'
        '400':
          description: Datos de entrada inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /restaurants/{restaurantId}/dishes:
    get:
      tags:
        - Dishes
      summary: Listar platos de un restaurante
      description: Lista los platos de un restaurante específico, con paginación y filtro opcional por categoría
      operationId: listDishesByRestaurant
      security:
        - bearerAuth: []
      parameters:
        - name: restaurantId
          in: path
          description: ID del restaurante
          required: true
          schema:
            type: integer
            format: int64
        - name: page
          in: query
          description: Número de página (empezando en 0)
          required: false
          schema:
            type: integer
            default: 0
            minimum: 0
        - name: size
          in: query
          description: Cantidad de elementos por página
          required: false
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
        - name: category
          in: query
          description: Filtrar por categoría (opcional)
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Lista de platos obtenida exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DishListResponse'
        '404':
          description: Restaurante no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /dishes:
    post:
      tags:
        - Dishes
      summary: Crear un nuevo plato
      description: Crea un nuevo plato en un restaurante (solo propietario del restaurante)
      operationId: createDish
      security:
        - bearerAuth: []
      requestBody:
        description: Datos del plato a crear
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DishRequest'
      responses:
        '201':
          description: Plato creado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DishDataResponse'
        '400':
          description: Datos de entrada inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /dishes/{id}:
    patch:
      tags:
        - Dishes
      summary: Actualizar precio y descripción de un plato
      description: Actualiza el precio y/o descripción de un plato (solo propietario del restaurante)
      operationId: updateDish
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          description: ID del plato a actualizar
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        description: Datos del plato a actualizar
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DishUpdateRequest'
      responses:
        '200':
          description: Plato actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DishDataResponse'
        '400':
          description: Datos de entrada inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Plato no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /dishes/{id}/toggle:
    patch:
      tags:
        - Dishes
      summary: Activar o desactivar un plato
      description: Permite activar o desactivar el estado de un plato existente
      operationId: toggleDishStatus
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          description: ID del plato
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Estado del plato actualizado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ToggleDishResponse'
        '400':
          description: Datos de entrada inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Plato no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders:
    post:
      tags:
        - Orders
      summary: Crear una nueva orden
      description: Crea una nueva orden en un restaurante
      operationId: createOrder
      security:
        - bearerAuth: []
      requestBody:
        description: Datos de la orden a crear
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrderRequest'
      responses:
        '201':
          description: Orden creada exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderDataResponse'
        '400':
          description: Datos de entrada inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    get:
      tags:
        - Orders
      summary: Listar pedidos por estado y restaurante del empleado
      description: Devuelve la lista de pedidos filtrados por estado, paginados
      operationId: listOrdersByStatusAndRestaurant
      security:
        - bearerAuth: []
      parameters:
        - name: status
          in: query
          description: "Estado por el que filtrar los pedidos. Ejemplo: PENDING, READY, DELIVERED"
          required: false
          schema:
            type: string
            example: PENDING
        - name: page
          in: query
          description: Número de página (empezando en 0)
          required: false
          schema:
            type: integer
            default: 0
            minimum: 0
        - name: size
          in: query
          description: Cantidad de elementos por página
          required: false
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
      responses:
        '200':
          description: Lista de pedidos obtenida exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderListResponse'
        '401':
          description: No autorizado (empleado no autenticado)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders/{orderId}/assign:
    patch:
      tags:
        - Orders
      summary: Asignarse a un pedido y cambiar estado a en preparación
      description: Permite al empleado asignarse a un pedido pendiente y cambiar su estado a "En Preparación"
      operationId: assignOrderToEmployee
      security:
        - bearerAuth: []
      parameters:
        - name: orderId
          in: path
          description: ID de la orden a asignar
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Orden asignada exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderDataResponse'
        '400':
          description: La orden no puede ser asignada (no está en estado Pendiente)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Orden no encontrada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders/{orderId}/ready:
    patch:
      tags:
        - Orders
      summary: Marcar pedido como listo
      description: Permite al empleado marcar un pedido como listo y enviar notificación SMS al cliente con el PIN de seguridad
      operationId: markOrderAsReady
      security:
        - bearerAuth: []
      parameters:
        - name: orderId
          in: path
          description: ID de la orden a marcar como lista
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Orden marcada como lista y notificación SMS enviada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderDataResponse'
        '400':
          description: La orden no puede ser marcada como lista (no está en estado En Preparación)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Orden no encontrada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders/{orderId}/deliver:
    patch:
      tags:
        - Orders
      summary: Marcar pedido como entregado
      description: Permite al empleado marcar un pedido como entregado validando el PIN de seguridad del cliente
      operationId: deliverOrder
      security:
        - bearerAuth: []
      parameters:
        - name: orderId
          in: path
          description: ID de la orden a entregar
          required: true
          schema:
            type: integer
            format: int64
      requestBody:
        description: PIN de seguridad del cliente
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeliverOrderRequest'
      responses:
        '200':
          description: Orden marcada como entregada exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderDataResponse'
        '400':
          description: Datos de entrada inválidos o PIN incorrecto
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Orden no encontrada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders/{orderId}/cancel:
    patch:
      tags:
        - Orders
      summary: Cancelar pedido
      description: Permite al cliente cancelar su pedido si está en estado Pendiente
      operationId: cancelOrder
      security:
        - bearerAuth: []
      parameters:
        - name: orderId
          in: path
          description: ID de la orden a cancelar
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Orden cancelada exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderDataResponse'
        '400':
          description: La orden no puede ser cancelada (no está en estado Pendiente)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Orden no encontrada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders/audit/history:
    get:
      tags:
        - Orders
      summary: Consultar historial de auditoría de mis pedidos
      description: |
        Permite al cliente autenticado consultar el historial de cambios de estado de sus propios pedidos.
        El cliente solo puede ver auditorías de sus propios pedidos (seguridad automática por token).
      operationId: getMyOrdersAuditHistory
      security:
        - bearerAuth: []
      parameters:
        - name: orderId
          in: query
          description: Filtrar por ID de pedido específico (opcional)
          required: false
          schema:
            type: integer
            format: int64
            example: 1
        - name: actionTypes
          in: query
          description: Filtrar por tipos de acción (puede enviar múltiples valores)
          required: false
          schema:
            type: array
            items:
              type: string
            example: ["ORDER_CREATED", "ASSIGNMENT", "DELIVERED"]
        - name: page
          in: query
          description: Número de página (empezando en 0)
          required: false
          schema:
            type: integer
            default: 0
            minimum: 0
        - name: size
          in: query
          description: Cantidad de elementos por página
          required: false
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
      responses:
        '200':
          description: Historial de auditoría obtenido exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderStatusAuditListResponse'
        '401':
          description: No autorizado (usuario no autenticado)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /metrics/orders-duration:
    get:
      tags:
        - Metrics
      summary: Obtener duración de pedidos
      description: |
        Obtiene el tiempo de duración de cada pedido desde que inicia (estado Pendiente) 
        hasta que termina (estado Entregado o Cancelado). Permite identificar pedidos 
        que tardan más que el promedio para optimizarlos.
      operationId: getOrdersDurationMetrics
      security:
        - bearerAuth: []
      parameters:
        - name: restaurantId
          in: query
          description: ID del restaurante para filtrar pedidos
          required: true
          schema:
            type: integer
            format: int64
        - name: startDate
          in: query
          description: Fecha de inicio del rango de consulta (formato ISO 8601)
          required: false
          schema:
            type: string
            format: date-time
            example: "2025-12-01T00:00:00"
        - name: endDate
          in: query
          description: Fecha de fin del rango de consulta (formato ISO 8601)
          required: false
          schema:
            type: string
            format: date-time
            example: "2025-12-31T23:59:59"
        - name: page
          in: query
          description: Número de página
          required: false
          schema:
            type: integer
            default: 0
        - name: size
          in: query
          description: Tamaño de página
          required: false
          schema:
            type: integer
            default: 20
        - name: sortBy
          in: query
          description: Campo por el cual ordenar (durationMinutes, orderId, completedAt)
          required: false
          schema:
            type: string
            default: "durationMinutes"
            enum:
              - durationMinutes
              - orderId
              - completedAt
        - name: sortDirection
          in: query
          description: Dirección del ordenamiento
          required: false
          schema:
            type: string
            default: "DESC"
            enum:
              - ASC
              - DESC
      responses:
        '200':
          description: Métricas obtenidas exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrdersDurationMetricsResponse'
        '400':
          description: Parámetros de consulta inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /metrics/employee-efficiency:
    get:
      tags:
        - Metrics
      summary: Obtener ranking de eficiencia de empleados
      description: |
        Obtiene un ranking de empleados mostrando el tiempo medio entre que un pedido 
        inicia (Pendiente) y termina (Entregado o Cancelado). Permite identificar 
        empleados con mejor rendimiento.
      operationId: getEmployeeEfficiencyMetrics
      security:
        - bearerAuth: []
      parameters:
        - name: restaurantId
          in: query
          description: ID del restaurante para filtrar empleados
          required: true
          schema:
            type: integer
            format: int64
        - name: startDate
          in: query
          description: Fecha de inicio del rango de consulta (formato ISO 8601)
          required: false
          schema:
            type: string
            format: date-time
            example: "2025-12-01T00:00:00"
        - name: endDate
          in: query
          description: Fecha de fin del rango de consulta (formato ISO 8601)
          required: false
          schema:
            type: string
            format: date-time
            example: "2025-12-31T23:59:59"
        - name: minOrdersCompleted
          in: query
          description: Número mínimo de pedidos completados para aparecer en el ranking
          required: false
          schema:
            type: integer
            default: 1
        - name: page
          in: query
          description: Número de página
          required: false
          schema:
            type: integer
            default: 0
        - name: size
          in: query
          description: Tamaño de página
          required: false
          schema:
            type: integer
            default: 20
        - name: sortBy
          in: query
          description: Campo por el cual ordenar (averageDurationMinutes, totalOrdersCompleted, employeeId)
          required: false
          schema:
            type: string
            default: "averageDurationMinutes"
            enum:
              - averageDurationMinutes
              - totalOrdersCompleted
              - employeeId
        - name: sortDirection
          in: query
          description: Dirección del ordenamiento
          required: false
          schema:
            type: string
            default: "ASC"
            enum:
              - ASC
              - DESC
      responses:
        '200':
          description: Ranking de eficiencia obtenido exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EmployeeEfficiencyMetricsResponse'
        '400':
          description: Parámetros de consulta inválidos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Error interno del servidor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    RestaurantRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: Nombre del restaurante (puede contener números pero no solo números)
          example: "Restaurante El Buen Sabor"
        nit:
          type: string
          pattern: '^[0-9]+$'
          maxLength: 20
          description: NIT del restaurante (solo números)
          example: "9001234567"
        address:
          type: string
          minLength: 1
          maxLength: 200
          description: Dirección del restaurante
          example: "Calle 123 #45-67"
        phoneNumber:
          type: string
          maxLength: 13
          pattern: '^\+?[0-9]{1,13}$'
          description: Teléfono del restaurante (máximo 13 caracteres, puede contener +)
          example: "+573001234567"
        urlLogo:
          type: string
          maxLength: 500
          description: URL del logo del restaurante
          example: "https://example.com/logo.png"
        ownerId:
          type: integer
          format: int64
          description: ID del usuario propietario del restaurante
          example: 1
      required:
        - name
        - nit
        - address
        - phoneNumber
        - urlLogo
        - ownerId

    RestaurantResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: ID único del restaurante
          example: 1
        name:
          type: string
          description: Nombre del restaurante
          example: "Restaurante El Buen Sabor"
        nit:
          type: string
          description: NIT del restaurante
          example: "9001234567"
        address:
          type: string
          description: Dirección del restaurante
          example: "Calle 123 #45-67"
        phoneNumber:
          type: string
          description: Teléfono del restaurante
          example: "+573001234567"
        urlLogo:
          type: string
          description: URL del logo del restaurante
          example: "https://example.com/logo.png"
        ownerId:
          type: integer
          format: int64
          description: ID del usuario propietario
          example: 1

    RestaurantDataResponse:
      type: object
      properties:
        data:
          $ref: '#/components/schemas/RestaurantResponse'
        message:
          type: string
          example: "Restaurante creado exitosamente"

    RestaurantLiteResponse:
      type: object
      properties:
        name:
          type: string
          description: Nombre del restaurante
          example: "Restaurante El Buen Sabor"
        urlLogo:
          type: string
          description: URL del logo del restaurante
          example: "https://example.com/logo.png"

    RestaurantListResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/RestaurantLiteResponse'
        page:
          type: integer
          description: Número de página actual
          example: 0
        size:
          type: integer
          description: Cantidad de elementos por página
          example: 10
        totalElements:
          type: integer
          format: int64
          description: Total de elementos
          example: 50
        totalPages:
          type: integer
          description: Total de páginas
          example: 5
        last:
          type: boolean
          description: Indica si es la última página
          example: false

    DishRequest:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: Nombre del plato
          example: "Bandeja Paisa"
        price:
          type: integer
          minimum: 1
          description: Precio del plato en números enteros positivos mayores a 0
          example: 25000
        description:
          type: string
          minLength: 1
          maxLength: 500
          description: Descripción del plato
          example: "Deliciosa bandeja paisa tradicional con todos los ingredientes"
        urlImage:
          type: string
          maxLength: 500
          description: URL de la imagen del plato
          example: "https://example.com/bandeja-paisa.jpg"
        category:
          type: string
          description: Categoría del plato
          example: "PLATOS_FUERTES"
        restaurantId:
          type: integer
          format: int64
          description: ID del restaurante al que pertenece el plato
          example: 1
      required:
        - name
        - price
        - description
        - urlImage
        - category
        - restaurantId

    DishUpdateRequest:
      type: object
      properties:
        price:
          type: integer
          minimum: 1
          description: Nuevo precio del plato
          example: 28000
        description:
          type: string
          minLength: 1
          maxLength: 500
          description: Nueva descripción del plato
          example: "Bandeja paisa mejorada con ingredientes premium"

    DishResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: ID único del plato
          example: 1
        name:
          type: string
          description: Nombre del plato
          example: "Bandeja Paisa"
        price:
          type: integer
          description: Precio del plato
          example: 25000
        description:
          type: string
          description: Descripción del plato
          example: "Deliciosa bandeja paisa tradicional"
        urlImage:
          type: string
          description: URL de la imagen del plato
          example: "https://example.com/bandeja-paisa.jpg"
        category:
          type: string
          description: Categoría del plato
          example: "PLATOS_FUERTES"
        active:
          type: boolean
          description: Indica si el plato está activo
          example: true
        restaurantId:
          type: integer
          format: int64
          description: ID del restaurante
          example: 1

    DishResponseLite:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: ID único del plato
          example: 1
        name:
          type: string
          description: Nombre del plato
          example: "Bandeja Paisa"
        price:
          type: integer
          description: Precio del plato
          example: 25000

    ToggleDishResponse:
        type: object
        properties:
            id:
              type: integer
              format: int64
              description: ID del plato
            active:
              type: boolean
              description: Nuevo estado del plato (true = activo, false = inactivo)
              example: false

    DishDataResponse:
      type: object
      properties:
        data:
          $ref: '#/components/schemas/DishResponse'
        message:
          type: string
          example: "Plato creado exitosamente"

    DishListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/DishResponse'
        page:
          type: integer
          description: Número de página actual
          example: 0
        size:
          type: integer
          description: Cantidad de elementos por página
          example: 10
        totalElements:
          type: integer
          format: int64
          description: Total de elementos
          example: 100
        totalPages:
          type: integer
          description: Total de páginas
          example: 10
        last:
          type: boolean
          description: Indica si es la última página
          example: false

    ErrorResponse:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
          description: Timestamp del error
          example: "2025-11-30T10:30:00Z"
        status:
          type: integer
          description: Código de estado HTTP
          example: 400
        error:
          type: string
          description: Tipo de error
          example: "Bad Request"
        message:
          type: string
          description: Mensaje descriptivo del error
          example: "El campo 'name' es requerido"
        path:
          type: string
          description: Path de la petición que causó el error
          example: "/api/v1/restaurants"

    OrderRequest:
      type: object
      properties:
        restaurantId:
          type: integer
          format: int64
          description: ID del restaurante
          example: 1
        dishes:
          type: array
          items:
            $ref: '#/components/schemas/OrderDishRequest'
          description: Lista de platos en la orden
      required:
        - restaurantId
        - dishes

    OrderDishRequest:
      type: object
      properties:
        dishId:
          type: integer
          format: int64
          description: ID del plato
          example: 5
        quantity:
          type: integer
          minimum: 1
          description: Cantidad de ese plato en la orden
          example: 2
      required:
        - dishId
        - quantity

    OrderDishResponse:
      type: object
      properties:
        dish:
          $ref: '#/components/schemas/DishResponseLite'
        quantity:
          type: integer
          description: Cantidad de ese plato en la orden
          example: 2

    DeliverOrderRequest:
      type: object
      properties:
        securityPin:
          type: string
          minLength: 6
          maxLength: 6
          pattern: '^[0-9]{6}$'
          description: PIN de seguridad de 6 dígitos
          example: "123456"
      required:
        - securityPin

    OrderResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: ID único de la orden
          example: 100
        restaurantId:
          type: integer
          format: int64
          description: ID del restaurante
          example: 1
        client:
          type: integer
          format: int64
          description: ID del cliente
          example: 10
        employee:
          type: integer
          format: int64
          description: ID del empleado asignado (puede ser null)
          example: 20
        status:
          type: string
          description: Estado de la orden
          example: "PENDING"
        dishes:
          type: array
          items:
            $ref: '#/components/schemas/OrderDishResponse'
        createdAt:
          type: string
          format: local-date-time
          description: Fecha y hora de creación
          example: "2025-12-01T10:30:00Z"

    OrderDataResponse:
      type: object
      properties:
        data:
          $ref: '#/components/schemas/OrderResponse'
        message:
          type: string
          example: "Orden creada exitosamente"

    OrderListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/OrderResponse'
        page:
          type: integer
          description: Número de página actual
          example: 0
        size:
          type: integer
          description: Cantidad de elementos por página
          example: 10
        totalElements:
          type: integer
          format: int64
          description: Total de elementos
          example: 50
        totalPages:
          type: integer
          description: Total de páginas
          example: 5
        last:
          type: boolean
          description: Indica si es la última página
          example: false

    # Schemas para integración con microservicio de Auditoría
    OrderStatusAuditRequest:
      type: object
      properties:
        orderId:
          type: integer
          format: int64
          description: ID del pedido
          example: 1
        restaurantId:
          type: integer
          format: int64
          description: ID del restaurante
          example: 5
        clientId:
          type: integer
          format: int64
          description: ID del cliente
          example: 10
        previousStatus:
          type: string
          maxLength: 50
          description: Estado anterior del pedido
          example: "PENDIENT"
        newStatus:
          type: string
          maxLength: 50
          description: Nuevo estado del pedido
          example: "IN_PREPARE"
        changedByUserId:
          type: integer
          format: int64
          description: ID del usuario que realizó el cambio
          example: 7
        changedByRole:
          type: string
          maxLength: 50
          description: Rol del usuario que realizó el cambio
          example: "EMPLEADO"
        actionType:
          type: string
          maxLength: 50
          description: Tipo de acción realizada
          example: "ASSIGNMENT"
        employeeId:
          type: integer
          format: int64
          description: ID del empleado asignado (si aplica)
          example: 7
        ipAddress:
          type: string
          maxLength: 45
          description: Dirección IP desde donde se realizó el cambio
          example: "192.168.1.100"
        userAgent:
          type: string
          maxLength: 500
          description: User agent del navegador/cliente
          example: "Mozilla/5.0"
        notes:
          type: string
          maxLength: 1000
          description: Notas adicionales
          example: "Pedido asignado al empleado"
        timeInPreviousStatusMinutes:
          type: integer
          format: int64
          description: Tiempo en el estado anterior en minutos
          example: 15

    OrderStatusAuditResponse:
      type: object
      properties:
        id:
          type: string
          description: ID único de la auditoría (MongoDB ObjectId)
          example: "507f1f77bcf86cd799439011"
        orderId:
          type: integer
          format: int64
          description: ID del pedido
          example: 1
        restaurantId:
          type: integer
          format: int64
          description: ID del restaurante
          example: 5
        clientId:
          type: integer
          format: int64
          description: ID del cliente
          example: 10
        previousStatus:
          type: string
          description: Estado anterior del pedido
          example: "PENDIENT"
        newStatus:
          type: string
          description: Nuevo estado del pedido
          example: "IN_PREPARE"
        changedByUserId:
          type: integer
          format: int64
          description: ID del usuario que realizó el cambio
          example: 7
        changedByRole:
          type: string
          description: Rol del usuario que realizó el cambio
          example: "EMPLEADO"
        changedAt:
          type: string
          format: local-date-time
          description: Fecha y hora del cambio
          example: "2025-12-02T10:30:00"
        actionType:
          type: string
          description: Tipo de acción realizada
          example: "ASSIGNMENT"
        employeeId:
          type: integer
          format: int64
          description: ID del empleado asignado (si aplica)
          example: 7
        ipAddress:
          type: string
          description: Dirección IP desde donde se realizó el cambio
          example: "192.168.1.100"
        userAgent:
          type: string
          description: User agent del navegador/cliente
          example: "Mozilla/5.0"
        notes:
          type: string
          description: Notas adicionales
          example: "Pedido asignado al empleado"
        timeInPreviousStatusMinutes:
          type: integer
          format: int64
          description: Tiempo en el estado anterior en minutos
          example: 15

    OrderStatusAuditDataResponse:
      type: object
      properties:
        data:
          $ref: '#/components/schemas/OrderStatusAuditResponse'

    PaginationMeta:
      type: object
      properties:
        page:
          type: integer
          description: Página actual
          example: 0
        size:
          type: integer
          description: Elementos por página
          example: 10
        totalElements:
          type: integer
          description: Total de elementos
          example: 100
        totalPages:
          type: integer
          description: Total de páginas
          example: 10

    OrderStatusAuditListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/OrderStatusAuditResponse'
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    # Schemas para métricas de duración de pedidos
    OrdersDurationMetricsResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            orders:
              type: array
              items:
                $ref: '#/components/schemas/OrderDurationMetric'
            summary:
              $ref: '#/components/schemas/DurationSummary'
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    OrderDurationMetric:
      type: object
      properties:
        orderId:
          type: integer
          format: int64
          description: ID del pedido
          example: 1
        clientId:
          type: integer
          format: int64
          description: ID del cliente
          example: 10
        employeeId:
          type: integer
          format: int64
          description: ID del empleado que procesó el pedido
          example: 7
        startedAt:
          type: string
          format: date-time
          description: Fecha y hora cuando el pedido inició (estado Pendiente)
          example: "2025-12-02T10:00:00Z"
        completedAt:
          type: string
          format: date-time
          description: Fecha y hora cuando el pedido finalizó (Entregado o Cancelado)
          example: "2025-12-02T10:45:00Z"
        finalStatus:
          type: string
          description: Estado final del pedido
          enum:
            - ENTREGADO
            - CANCELADO
          example: "ENTREGADO"
        durationMinutes:
          type: integer
          format: int64
          description: Duración total del pedido en minutos
          example: 45

    DurationSummary:
      type: object
      properties:
        totalOrders:
          type: integer
          description: Total de pedidos completados en el período
          example: 150
        averageDurationMinutes:
          type: number
          format: double
          description: Duración promedio de todos los pedidos en minutos
          example: 30.5
        minDurationMinutes:
          type: integer
          format: int64
          description: Duración mínima encontrada
          example: 15
        maxDurationMinutes:
          type: integer
          format: int64
          description: Duración máxima encontrada
          example: 120
        medianDurationMinutes:
          type: number
          format: double
          description: Mediana de la duración
          example: 28.0
        deliveredCount:
          type: integer
          description: Cantidad de pedidos entregados
          example: 140
        cancelledCount:
          type: integer
          description: Cantidad de pedidos cancelados
          example: 10

    # Schemas para métricas de eficiencia de empleados
    EmployeeEfficiencyMetricsResponse:
      type: object
      properties:
        data:
          type: object
          properties:
            ranking:
              type: array
              items:
                $ref: '#/components/schemas/EmployeeEfficiencyMetric'
            summary:
              $ref: '#/components/schemas/EmployeeEfficiencySummary'
        meta:
          $ref: '#/components/schemas/PaginationMeta'

    EmployeeEfficiencyMetric:
      type: object
      properties:
        rank:
          type: integer
          description: Posición en el ranking (1 = más eficiente)
          example: 1
        employeeId:
          type: integer
          format: int64
          description: ID del empleado
          example: 7
        totalOrdersCompleted:
          type: integer
          description: Total de pedidos completados por el empleado
          example: 45
        totalOrdersDelivered:
          type: integer
          description: Total de pedidos entregados
          example: 42
        totalOrdersCancelled:
          type: integer
          description: Total de pedidos cancelados
          example: 3
        averageDurationMinutes:
          type: number
          format: double
          description: Tiempo promedio de procesamiento en minutos
          example: 25.5
        minDurationMinutes:
          type: integer
          format: int64
          description: Tiempo mínimo de procesamiento
          example: 15
        maxDurationMinutes:
          type: integer
          format: int64
          description: Tiempo máximo de procesamiento
          example: 60
        medianDurationMinutes:
          type: number
          format: double
          description: Mediana del tiempo de procesamiento
          example: 24.0

    EmployeeEfficiencySummary:
      type: object
      properties:
        totalEmployees:
          type: integer
          description: Total de empleados en el ranking
          example: 15
        restaurantAverageDurationMinutes:
          type: number
          format: double
          description: Tiempo promedio del restaurante
          example: 30.5
        bestEmployeeAverageDurationMinutes:
          type: number
          format: double
          description: Mejor tiempo promedio entre todos los empleados
          example: 22.0
        worstEmployeeAverageDurationMinutes:
          type: number
          format: double
          description: Peor tiempo promedio entre todos los empleados
          example: 45.0
        totalOrdersProcessed:
          type: integer
          description: Total de pedidos procesados en el período
          example: 450

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: "Autenticación mediante token JWT. Formato: 'Bearer {token}'"

